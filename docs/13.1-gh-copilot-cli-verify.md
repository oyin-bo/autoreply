# GitHub Copilot CLI Support - Research & Requirements

## Executive Summary

**YES, GitHub Copilot CLI supports MCP!** The new GitHub Copilot CLI (released 2025) has built-in MCP support and can be extended with custom MCP servers. Our existing Go and Rust MCP servers should work with it with minimal changes.

## Key Findings

### 1. GitHub Copilot CLI Has Native MCP Support

From the [official documentation](https://docs.github.com/en/copilot/concepts/agents/about-copilot-cli):

> **MCP-powered extensibility:** Take advantage of the fact that the coding agent ships with GitHub's MCP server by default and supports custom MCP servers to extend capabilities.

The documentation explicitly mentions:
- "Use the Github MCP server to find good first issues..."
- Tool approval system includes MCP servers: `--allow-tool 'MCP_SERVER_NAME'` and `--deny-tool 'My-MCP-Server(tool_name)'`
- `/mcp` slash command in interactive mode to list and manage MCP servers

### 2. Comparison: Gemini CLI vs GitHub Copilot CLI

| Feature | Gemini CLI | GitHub Copilot CLI |
|---------|-----------|-------------------|
| **MCP Support** | ✅ Yes, via settings.json | ✅ Yes, built-in + custom servers |
| **Configuration** | `.gemini/settings.json` | `~/.config/copilot/config.json` |
| **CLI Interface** | `gemini -p "prompt"` | `copilot -p "prompt"` |
| **Output Format** | `--output-format json` | JSON by default in programmatic mode |
| **Interactive Mode** | ✅ Yes | ✅ Yes |
| **Tool Approval** | Automatic (policy-based) | Manual or `--allow-all-tools` |
| **Authentication** | Google account | GitHub account |
| **Cost** | Free (with Gemini API) | Requires Copilot subscription |
| **MCP Discovery** | Via settings.json mcpServers | Via config.json or environment |

### 3. GitHub Copilot CLI Architecture

**Command Structure:**
```bash
# Interactive mode (default)
copilot

# Programmatic mode (like our tests)
copilot -p "Use autoreply profile tool to get bsky.app" --allow-tool 'autoreply'

# Tool approval options
copilot --allow-all-tools          # Allow all tools
copilot --allow-tool 'autoreply'   # Allow specific MCP server
copilot --deny-tool 'shell(rm)'    # Deny specific command
```

**Configuration Location:**
- Default: `~/.config/copilot/config.json` (Linux/macOS)
- Can override with `XDG_CONFIG_HOME` environment variable
- Windows: Similar to Linux via WSL or PowerShell (experimental)

### 4. Migration Status

**Old Tool (DEPRECATED - October 25, 2025):**
- `gh copilot` - GitHub CLI extension
- Commands: `gh copilot suggest`, `gh copilot explain`
- No MCP support

**New Tool (CURRENT):**
- `@github/copilot` - Standalone npm package
- Full agentic capabilities with MCP support
- Installed via: `npm install -g @github/copilot`

## What's Needed for GitHub Copilot CLI Support

### Option 1: Minimal - Reuse Existing Configuration ✅ RECOMMENDED

**No code changes needed!** GitHub Copilot CLI can likely use the same `.gemini/settings.json` or a similar config.

**Test approach:**
1. Create `.copilot/config.json` (or similar) in project root
2. Use same MCP server configuration format
3. Run: `copilot -p "test prompt" --allow-tool 'autoreply'`

**Pros:**
- No server code changes
- Same test harness works for both CLIs
- Validates MCP protocol compliance

### Option 2: Unified Test Harness - Support Both CLIs ✅ BEST APPROACH

Modify `mcp-test.js` to detect and use whichever CLI is available:

```javascript
// Auto-detect available CLI
function detectCLI() {
  try {
    execSync('gemini --version', { stdio: 'ignore' });
    return 'gemini';
  } catch {
    try {
      execSync('copilot --version', { stdio: 'ignore' });
      return 'copilot';
    } catch {
      throw new Error('Neither Gemini CLI nor Copilot CLI found');
    }
  }
}

function runPrompt(cli, prompt) {
  if (cli === 'gemini') {
    return `gemini -p "${prompt}" --output-format json`;
  } else {
    return `copilot -p "${prompt}" --allow-tool 'autoreply'`;
  }
}
```

### Option 3: Separate Test Suites

Create parallel test files:
- `mcp-test-gemini.js` - For Gemini CLI
- `mcp-test-copilot.js` - For GitHub Copilot CLI
- `mcp-test-all.js` - Runs both

## Configuration Requirements

### For Gemini CLI (Current)
```json
{
  "mcp": {
    "allowed": ["autoreply"]
  },
  "mcpServers": {
    "autoreply": {
      "type": "stdio",
      "command": ".\\autoreply.exe",
      "args": [],
      "cwd": ".",
      "timeout": 30000,
      "trust": true
    }
  }
}
```

### For GitHub Copilot CLI (Expected)
```json
{
  "mcpServers": {
    "autoreply": {
      "command": ".\\autoreply.exe",
      "args": [],
      "env": {},
      "cwd": "."
    }
  }
}
```

**Note:** The exact schema needs verification by testing, but it should be similar to Gemini CLI's format since both follow MCP specifications.

## Implementation Plan

### Phase 1: Research & Validation (CURRENT)
- ✅ Confirm GitHub Copilot CLI has MCP support
- ✅ Document configuration requirements
- ✅ Identify command-line interface differences

### Phase 2: Basic Compatibility Testing
1. Install GitHub Copilot CLI: `npm install -g @github/copilot`
2. Authenticate: `copilot` then `/login`
3. Create test configuration for autoreply server
4. Run basic test: `copilot -p "List available tools" --allow-tool 'autoreply'`
5. Verify tool discovery works

### Phase 3: Extend Test Harness
1. Modify `mcp-test.js` to detect available CLI
2. Add CLI-specific command formatting
3. Update test assertions to handle output differences
4. Add CLI selection via environment variable or flag
5. Update documentation

### Phase 4: CI/CD Integration
1. Add GitHub Copilot CLI to test environment
2. Run test suite against both CLIs in parallel
3. Report compatibility status in README
4. Badge showing "Works with Gemini CLI ✓" and "Works with Copilot CLI ✓"

## Benefits of Supporting Both CLIs

1. **Broader Reach:** Users can choose their preferred AI assistant
2. **Protocol Validation:** Proves MCP implementation is standards-compliant
3. **Future-Proofing:** Ready for other MCP clients (VSCode, Claude Desktop, etc.)
4. **Marketing:** "Compatible with Gemini CLI & GitHub Copilot CLI" is a strong selling point
5. **Testing:** Cross-validation between two independent clients

## Potential Challenges

### 1. Output Format Differences
- **Gemini CLI:** Explicit `--output-format json` flag
- **Copilot CLI:** JSON output in programmatic mode, but format may differ

**Solution:** Normalize JSON output in test harness before assertion matching

### 2. Tool Approval Mechanisms
- **Gemini CLI:** Policy-based, mostly automatic
- **Copilot CLI:** Requires explicit `--allow-tool` or interactive approval

**Solution:** Always use `--allow-tool 'autoreply'` in automated tests

### 3. Authentication Requirements
- **Gemini CLI:** Google account, free API access
- **Copilot CLI:** GitHub account, requires paid Copilot subscription

**Solution:** Document both requirements, mark Copilot tests as optional if no subscription

### 4. Platform Support
- **Gemini CLI:** Works on Windows, Linux, macOS
- **Copilot CLI:** Windows support is "experimental" (PowerShell 6+)

**Solution:** Test both CLIs on each platform, document limitations

### 5. MCP Error Warnings
- Both CLIs may log MCP validation warnings to STDERR
- These are non-fatal but noisy

**Solution:** Filter STDERR or document as expected behavior

## Recommended Next Steps

1. **Immediate (This Session):**
   - ✅ Complete this research document
   - ✅ Update docs/13-gemini-cli-verify.md to mention Copilot CLI support
   - Create GitHub issue: "Add GitHub Copilot CLI support to test harness"

2. **Short Term (Next Development Session):**
   - Install GitHub Copilot CLI
   - Manually test autoreply server with Copilot CLI
   - Document configuration format
   - Create proof-of-concept test

3. **Medium Term:**
   - Implement unified test harness
   - Add CI/CD testing for both CLIs
   - Update README with compatibility badges

4. **Long Term:**
   - Test with other MCP clients (VSCode, Claude Desktop)
   - Create compatibility matrix
   - Contribute findings back to MCP community

## References

- [GitHub Copilot CLI Documentation](https://docs.github.com/en/copilot/concepts/agents/about-copilot-cli)
- [GitHub Copilot CLI Repository](https://github.com/github/copilot-cli)
- [Gemini CLI MCP Configuration](../gemini-cli/docs/get-started/configuration.md)
- [Model Context Protocol Specification](https://modelcontextprotocol.io)
- [Our Current Test Results](./13-gemini-cli-verify.md)

## Conclusion

**GitHub Copilot CLI is a fully viable MCP client for testing our autoreply server.** The new CLI has native MCP support and follows the same protocol standards as Gemini CLI.

**Recommendation:** Extend our test harness to support both CLIs with auto-detection. This will:
- Validate our MCP implementation against multiple clients
- Provide users with choice
- Future-proof the testing infrastructure
- Demonstrate broad compatibility

The implementation is straightforward since both CLIs use similar configuration formats and command-line interfaces. The main work is adapting the test harness to handle minor output format differences and tool approval mechanisms.
